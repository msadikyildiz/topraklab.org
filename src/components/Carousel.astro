---
import { Image } from 'astro:assets';

interface Props {
  images: { src: ImageMetadata; alt: string }[];
}

const { images } = Astro.props;
---

<div class="carousel" aria-label="Lab photo slideshow">
  <div class="carousel__track">
    {images.map((img, i) => (
      <div class:list={['carousel__slide', { 'carousel__slide--active': i === 0 }]} data-index={i}>
        <Image src={img.src} alt={img.alt} width={1920} height={754} loading={i === 0 ? 'eager' : 'lazy'} />
      </div>
    ))}
  </div>
  <div class="carousel__controls">
    <button class="carousel__btn carousel__btn--prev" aria-label="Previous slide">&lsaquo;</button>
    <button class="carousel__btn carousel__btn--next" aria-label="Next slide">&rsaquo;</button>
  </div>
</div>

<style>
  .carousel {
    position: relative;
    overflow: hidden;
    max-width: 960px;
    margin-inline: auto;
    aspect-ratio: 960 / 377;
    background-color: var(--color-gray-100);
  }

  .carousel__track {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .carousel__slide {
    position: absolute;
    inset: 0;
    opacity: 0;
    transition: opacity 1s ease;
  }

  .carousel__slide--active {
    opacity: 1;
  }

  .carousel__slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .carousel__controls {
    position: absolute;
    inset: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-inline: 0.5rem;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .carousel:hover .carousel__controls {
    opacity: 1;
  }

  .carousel__btn {
    background: rgba(0, 0, 0, 0.3);
    color: white;
    border: none;
    font-size: 2rem;
    width: 2.5rem;
    height: 2.5rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
  }

  .carousel__btn:hover {
    background: rgba(0, 0, 0, 0.5);
  }

  @media (max-width: 768px) {
    .carousel { aspect-ratio: 16 / 9; }
  }

  @media (max-width: 480px) {
    .carousel { aspect-ratio: 4 / 3; }
  }

  @media (hover: none) {
    .carousel__controls { opacity: 1; }
    .carousel__btn {
      width: 3rem;
      height: 3rem;
      font-size: 1.75rem;
      background: rgba(0, 0, 0, 0.25);
      border-radius: 4px;
    }
  }
</style>

<script>
  const carousel = document.querySelector('.carousel');
  if (carousel) {
    const slides = carousel.querySelectorAll('.carousel__slide');
    const prevBtn = carousel.querySelector('.carousel__btn--prev');
    const nextBtn = carousel.querySelector('.carousel__btn--next');
    let current = 0;
    let timer: ReturnType<typeof setInterval>;

    function show(index: number) {
      slides[current].classList.remove('carousel__slide--active');
      current = (index + slides.length) % slides.length;
      slides[current].classList.add('carousel__slide--active');
    }

    function startAuto() {
      timer = setInterval(() => show(current + 1), 5000);
    }

    prevBtn?.addEventListener('click', () => { clearInterval(timer); show(current - 1); startAuto(); });
    nextBtn?.addEventListener('click', () => { clearInterval(timer); show(current + 1); startAuto(); });

    startAuto();
  }
</script>
